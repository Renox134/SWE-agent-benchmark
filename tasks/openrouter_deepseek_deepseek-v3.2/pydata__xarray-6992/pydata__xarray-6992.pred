{"model_name_or_path": "openrouter_deepseek_deepseek-v3.2", "instance_id": "pydata__xarray-6992", "model_patch": "diff --git a/debug_error.py b/debug_error.py\nnew file mode 100644\nindex 00000000..15537bd9\n--- /dev/null\n+++ b/debug_error.py\n@@ -0,0 +1,47 @@\n+import xarray as xr\n+\n+print(\"Testing the MVCE from the PR description...\")\n+try:\n+    ds = xr.Dataset(coords={\"a\": (\"x\", [1, 2, 3]), \"b\": (\"x\", ['a', 'b', 'c'])})\n+    print(f\"Original dataset: {ds}\")\n+    print(f\"_variables: {ds._variables}\")\n+    print(f\"_coord_names: {ds._coord_names}\")\n+    print(f\"len(_variables): {len(ds._variables)}\")\n+    print(f\"len(_coord_names): {len(ds._coord_names)}\")\n+    print(f\"len(ds.data_vars): {len(ds.data_vars)}\")\n+    \n+    ds_with_index = ds.set_index(z=['a', 'b'])\n+    print(f\"\\nDataset with index: {ds_with_index}\")\n+    print(f\"_variables: {ds_with_index._variables}\")\n+    print(f\"_coord_names: {ds_with_index._coord_names}\")\n+    print(f\"len(_variables): {len(ds_with_index._variables)}\")\n+    print(f\"len(_coord_names): {len(ds_with_index._coord_names)}\")\n+    print(f\"len(ds.data_vars): {len(ds_with_index.data_vars)}\")\n+    \n+    result = ds_with_index.reset_index(\"z\", drop=True)\n+    print(f\"\\nAfter reset_index with drop=True:\")\n+    print(f\"_variables: {result._variables}\")\n+    print(f\"_coord_names: {result._coord_names}\")\n+    print(f\"len(_variables): {len(result._variables)}\")\n+    print(f\"len(_coord_names): {len(result._coord_names)}\")\n+    print(f\"len(ds.data_vars): {len(result.data_vars)}\")\n+    \n+    # Let's manually check what happens in DataVariables.__len__\n+    print(f\"\\nManual calculation of len(data_vars):\")\n+    print(f\"len(_variables) - len(_coord_names) = {len(result._variables)} - {len(result._coord_names)} = {len(result._variables) - len(result._coord_names)}\")\n+    \n+    # Let's check what's actually in each\n+    print(f\"\\nVariables in _variables but not in _coord_names:\")\n+    for key in result._variables:\n+        if key not in result._coord_names:\n+            print(f\"  {key}\")\n+    \n+    print(f\"\\nVariables in _coord_names but not in _variables:\")\n+    for key in result._coord_names:\n+        if key not in result._variables:\n+            print(f\"  {key}\")\n+            \n+except Exception as e:\n+    print(f\"Error: {type(e).__name__}: {e}\")\n+    import traceback\n+    traceback.print_exc()\n\\ No newline at end of file\ndiff --git a/reproduce_error.py b/reproduce_error.py\nnew file mode 100644\nindex 00000000..08672a74\n--- /dev/null\n+++ b/reproduce_error.py\n@@ -0,0 +1,55 @@\n+import xarray as xr\n+\n+print(\"Testing the MVCE from the PR description...\")\n+try:\n+    ds = xr.Dataset(coords={\"a\": (\"x\", [1, 2, 3]), \"b\": (\"x\", ['a', 'b', 'c'])})\n+    result = ds.set_index(z=['a', 'b']).reset_index(\"z\", drop=True)\n+    print(\"Success! Result:\")\n+    print(result)\n+except Exception as e:\n+    print(f\"Error: {type(e).__name__}: {e}\")\n+    import traceback\n+    traceback.print_exc()\n+\n+print(\"\\nLet's also test some edge cases...\")\n+print(\"\\n1. Testing regular dataset:\")\n+try:\n+    ds = xr.Dataset({\"temp\": (\"x\", [1, 2, 3])}, coords={\"x\": [1, 2, 3]})\n+    print(f\"Dataset: {ds}\")\n+    print(f\"_variables: {ds._variables}\")\n+    print(f\"_coord_names: {ds._coord_names}\")\n+    print(f\"len(_variables): {len(ds._variables)}\")\n+    print(f\"len(_coord_names): {len(ds._coord_names)}\")\n+    print(f\"len(ds.data_vars): {len(ds.data_vars)}\")\n+except Exception as e:\n+    print(f\"Error: {type(e).__name__}: {e}\")\n+\n+print(\"\\n2. Testing dataset with multi-index:\")\n+try:\n+    ds = xr.Dataset(coords={\"a\": (\"x\", [1, 2, 3]), \"b\": (\"x\", ['a', 'b', 'c'])})\n+    print(f\"Original dataset: {ds}\")\n+    print(f\"_variables: {ds._variables}\")\n+    print(f\"_coord_names: {ds._coord_names}\")\n+    print(f\"len(_variables): {len(ds._variables)}\")\n+    print(f\"len(_coord_names): {len(ds._coord_names)}\")\n+    print(f\"len(ds.data_vars): {len(ds.data_vars)}\")\n+    \n+    ds_with_index = ds.set_index(z=['a', 'b'])\n+    print(f\"\\nDataset with index: {ds_with_index}\")\n+    print(f\"_variables: {ds_with_index._variables}\")\n+    print(f\"_coord_names: {ds_with_index._coord_names}\")\n+    print(f\"len(_variables): {len(ds_with_index._variables)}\")\n+    print(f\"len(_coord_names): {len(ds_with_index._coord_names)}\")\n+    print(f\"len(ds.data_vars): {len(ds_with_index.data_vars)}\")\n+    \n+    result = ds_with_index.reset_index(\"z\", drop=True)\n+    print(f\"\\nAfter reset_index with drop=True: {result}\")\n+    print(f\"_variables: {result._variables}\")\n+    print(f\"_coord_names: {result._coord_names}\")\n+    print(f\"len(_variables): {len(result._variables)}\")\n+    print(f\"len(_coord_names): {len(result._coord_names)}\")\n+    print(f\"len(ds.data_vars): {len(result.data_vars)}\")\n+except Exception as e:\n+    print(f\"Error: {type(e).__name__}: {e}\")\n+    import traceback\n+    traceback.print_exc()\n\\ No newline at end of file\n"}