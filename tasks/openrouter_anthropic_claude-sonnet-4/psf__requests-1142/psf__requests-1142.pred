{"model_name_or_path": "openrouter_anthropic_claude-sonnet-4", "instance_id": "psf__requests-1142", "model_patch": "diff --git a/debug_content_length.py b/debug_content_length.py\nnew file mode 100644\nindex 0000000..f617a0a\n--- /dev/null\n+++ b/debug_content_length.py\n@@ -0,0 +1,32 @@\n+#!/usr/bin/env python\n+\"\"\"Debug the content length logic.\"\"\"\n+\n+import requests\n+from requests.models import PreparedRequest\n+\n+# Monkey patch to add debug prints\n+original_prepare_content_length = PreparedRequest.prepare_content_length\n+\n+def debug_prepare_content_length(self, body):\n+    print(f\"DEBUG: prepare_content_length called with body={repr(body)}, method={self.method}\")\n+    print(f\"DEBUG: body is not None = {body is not None}\")\n+    print(f\"DEBUG: body != '' = {body != ''}\")\n+    print(f\"DEBUG: body != [] = {body != []}\")\n+    print(f\"DEBUG: body != {{}} = {body != {}}\")\n+    \n+    condition = body is not None and body != '' and body != [] and body != {}\n+    print(f\"DEBUG: Overall condition = {condition}\")\n+    \n+    return original_prepare_content_length(self, body)\n+\n+PreparedRequest.prepare_content_length = debug_prepare_content_length\n+\n+def test_case():\n+    print(\"Testing GET request with data=None:\")\n+    req = requests.Request('GET', 'http://httpbin.org/get', data=None)\n+    prepared = req.prepare()\n+    \n+    print(f\"Final headers: {dict(prepared.headers)}\")\n+\n+if __name__ == \"__main__\":\n+    test_case()\n\\ No newline at end of file\ndiff --git a/debug_issue.py b/debug_issue.py\nnew file mode 100644\nindex 0000000..2806d43\n--- /dev/null\n+++ b/debug_issue.py\n@@ -0,0 +1,45 @@\n+#!/usr/bin/env python\n+\"\"\"Debug script to understand the data=None case.\"\"\"\n+\n+import requests\n+from requests.models import PreparedRequest\n+\n+def debug_request_creation():\n+    \"\"\"Debug the request creation process.\"\"\"\n+    print(\"=== Debugging Request Creation ===\")\n+    \n+    # Case 1: No data parameter\n+    print(\"\\n1. GET request with no data parameter:\")\n+    req1 = requests.Request('GET', 'http://httpbin.org/get')\n+    print(f\"  req1.data = {repr(req1.data)}\")\n+    print(f\"  req1.data is None = {req1.data is None}\")\n+    print(f\"  bool(req1.data) = {bool(req1.data)}\")\n+    \n+    # Case 2: Explicit data=None\n+    print(\"\\n2. GET request with data=None:\")\n+    req2 = requests.Request('GET', 'http://httpbin.org/get', data=None)\n+    print(f\"  req2.data = {repr(req2.data)}\")\n+    print(f\"  req2.data is None = {req2.data is None}\")\n+    print(f\"  bool(req2.data) = {bool(req2.data)}\")\n+    \n+    # Case 3: Empty dict\n+    print(\"\\n3. GET request with data={}:\")\n+    req3 = requests.Request('GET', 'http://httpbin.org/get', data={})\n+    print(f\"  req3.data = {repr(req3.data)}\")\n+    print(f\"  req3.data is None = {req3.data is None}\")\n+    print(f\"  bool(req3.data) = {bool(req3.data)}\")\n+    \n+    # Test preparation\n+    print(\"\\n=== Testing Preparation ===\")\n+    for i, req in enumerate([req1, req2, req3], 1):\n+        print(f\"\\nCase {i} preparation:\")\n+        prepared = req.prepare()\n+        print(f\"  prepared.body = {repr(prepared.body)}\")\n+        print(f\"  prepared.body is None = {prepared.body is None}\")\n+        if 'Content-Length' in prepared.headers:\n+            print(f\"  Content-Length = {prepared.headers['Content-Length']}\")\n+        else:\n+            print(\"  No Content-Length header\")\n+\n+if __name__ == \"__main__\":\n+    debug_request_creation()\n\\ No newline at end of file\ndiff --git a/debug_prepare_body.py b/debug_prepare_body.py\nnew file mode 100644\nindex 0000000..c432cb0\n--- /dev/null\n+++ b/debug_prepare_body.py\n@@ -0,0 +1,51 @@\n+#!/usr/bin/env python\n+\"\"\"Debug the prepare_body method.\"\"\"\n+\n+import requests\n+from requests.models import PreparedRequest\n+\n+# Monkey patch to add debug prints\n+original_prepare_body = PreparedRequest.prepare_body\n+\n+def debug_prepare_body(self, data, files):\n+    print(f\"DEBUG: prepare_body called with data={repr(data)}, files={repr(files)}\")\n+    \n+    # Copy the logic from prepare_body to see which path is taken\n+    body = None\n+    content_type = None\n+    length = None\n+    is_stream = False\n+\n+    from requests.compat import basestring\n+    is_stream = all([\n+        hasattr(data, '__iter__'),\n+        not isinstance(data, basestring),\n+        not isinstance(data, dict)\n+    ])\n+    \n+    print(f\"DEBUG: is_stream = {is_stream}\")\n+    print(f\"DEBUG: hasattr(data, '__iter__') = {hasattr(data, '__iter__')}\")\n+    print(f\"DEBUG: isinstance(data, basestring) = {isinstance(data, basestring)}\")\n+    print(f\"DEBUG: isinstance(data, dict) = {isinstance(data, dict)}\")\n+    \n+    from requests.utils import super_len\n+    try:\n+        length = str(super_len(data))\n+        print(f\"DEBUG: length = {length}\")\n+    except (TypeError, AttributeError):\n+        length = False\n+        print(f\"DEBUG: length = False (exception)\")\n+    \n+    return original_prepare_body(self, data, files)\n+\n+PreparedRequest.prepare_body = debug_prepare_body\n+\n+def test_case():\n+    print(\"Testing GET request with data=None:\")\n+    req = requests.Request('GET', 'http://httpbin.org/get', data=None)\n+    prepared = req.prepare()\n+    \n+    print(f\"Final headers: {dict(prepared.headers)}\")\n+\n+if __name__ == \"__main__\":\n+    test_case()\n\\ No newline at end of file\ndiff --git a/reproduce_issue.py b/reproduce_issue.py\nnew file mode 100644\nindex 0000000..90538f6\n--- /dev/null\n+++ b/reproduce_issue.py\n@@ -0,0 +1,81 @@\n+#!/usr/bin/env python\n+\"\"\"Script to reproduce the content-length issue with GET requests.\"\"\"\n+\n+import requests\n+from requests.models import PreparedRequest\n+\n+def test_get_request_headers():\n+    \"\"\"Test that GET requests include content-length header.\"\"\"\n+    print(\"Testing GET request headers...\")\n+    \n+    # Create a simple GET request\n+    req = requests.Request('GET', 'http://httpbin.org/get')\n+    prepared = req.prepare()\n+    \n+    print(\"Headers for GET request:\")\n+    for header, value in prepared.headers.items():\n+        print(f\"  {header}: {value}\")\n+    \n+    # Check if Content-Length is present\n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\\nPROBLEM: Content-Length header is present: {prepared.headers['Content-Length']}\")\n+        return True\n+    else:\n+        print(\"\\nOK: No Content-Length header found\")\n+        return False\n+\n+def test_post_request_headers():\n+    \"\"\"Test that POST requests correctly include content-length header.\"\"\"\n+    print(\"\\nTesting POST request headers...\")\n+    \n+    # Create a POST request with data\n+    req = requests.Request('POST', 'http://httpbin.org/post', data={'key': 'value'})\n+    prepared = req.prepare()\n+    \n+    print(\"Headers for POST request:\")\n+    for header, value in prepared.headers.items():\n+        print(f\"  {header}: {value}\")\n+    \n+    # Check if Content-Length is present\n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\\nOK: Content-Length header is present: {prepared.headers['Content-Length']}\")\n+        return False\n+    else:\n+        print(\"\\nPROBLEM: No Content-Length header found for POST\")\n+        return True\n+\n+def test_get_request_no_data():\n+    \"\"\"Test GET request with no data explicitly set.\"\"\"\n+    print(\"\\nTesting GET request with no data...\")\n+    \n+    req = requests.Request('GET', 'http://httpbin.org/get', data=None)\n+    prepared = req.prepare()\n+    \n+    print(\"Headers for GET request (data=None):\")\n+    for header, value in prepared.headers.items():\n+        print(f\"  {header}: {value}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\\nPROBLEM: Content-Length header is present: {prepared.headers['Content-Length']}\")\n+        return True\n+    else:\n+        print(\"\\nOK: No Content-Length header found\")\n+        return False\n+\n+if __name__ == \"__main__\":\n+    has_issue = False\n+    result1 = test_get_request_headers()\n+    result2 = test_post_request_headers()\n+    result3 = test_get_request_no_data()\n+    \n+    print(f\"\\nDEBUG: result1={result1}, result2={result2}, result3={result3}\")\n+    \n+    has_issue = result1 or result2 or result3\n+    print(f\"DEBUG: has_issue={has_issue}\")\n+    \n+    if has_issue:\n+        print(\"\\n=== ISSUE CONFIRMED ===\")\n+        print(\"GET requests are incorrectly including Content-Length header\")\n+    else:\n+        print(\"\\n=== NO ISSUE FOUND ===\")\n+        print(\"Content-Length header behavior is correct\")\n\\ No newline at end of file\ndiff --git a/requests/models.py b/requests/models.py\nindex 9926045..95b91e4 100644\n--- a/requests/models.py\n+++ b/requests/models.py\n@@ -359,7 +359,10 @@ class PreparedRequest(RequestEncodingMixin, RequestHooksMixin):\n                 raise NotImplementedError('Streamed bodies and files are mutually exclusive.')\n \n             if length:\n-                self.headers['Content-Length'] = length\n+                # Only set Content-Length for streaming if there's actual content\n+                # or if the method typically requires it\n+                if length != '0' or self.method in ('POST', 'PUT', 'PATCH'):\n+                    self.headers['Content-Length'] = length\n             else:\n                 self.headers['Transfer-Encoding'] = 'chunked'\n         # Check if file, fo, generator, iterator.\n@@ -386,13 +389,19 @@ class PreparedRequest(RequestEncodingMixin, RequestHooksMixin):\n         self.body = body\n \n     def prepare_content_length(self, body):\n-        self.headers['Content-Length'] = '0'\n-        if hasattr(body, 'seek') and hasattr(body, 'tell'):\n-            body.seek(0, 2)\n-            self.headers['Content-Length'] = str(body.tell())\n-            body.seek(0, 0)\n-        elif body is not None:\n-            self.headers['Content-Length'] = str(len(body))\n+        # Only set Content-Length header if there's actually a body\n+        # or if the method typically requires it\n+        if body is not None and body != '' and body != [] and body != {}:\n+            if hasattr(body, 'seek') and hasattr(body, 'tell'):\n+                body.seek(0, 2)\n+                self.headers['Content-Length'] = str(body.tell())\n+                body.seek(0, 0)\n+            else:\n+                self.headers['Content-Length'] = str(len(body))\n+        elif self.method in ('POST', 'PUT', 'PATCH'):\n+            # For methods that typically send data, set Content-Length to 0 if no body\n+            self.headers['Content-Length'] = '0'\n+        # For GET, HEAD, DELETE, OPTIONS, don't set Content-Length if no body\n \n     def prepare_auth(self, auth):\n         \"\"\"Prepares the given HTTP auth data.\"\"\"\ndiff --git a/test_basic_functionality.py b/test_basic_functionality.py\nnew file mode 100644\nindex 0000000..f230a8c\n--- /dev/null\n+++ b/test_basic_functionality.py\n@@ -0,0 +1,85 @@\n+#!/usr/bin/env python\n+\"\"\"Test basic functionality to ensure my changes don't break anything.\"\"\"\n+\n+import requests\n+from requests.models import Request, PreparedRequest\n+\n+def test_basic_request_preparation():\n+    \"\"\"Test that basic request preparation still works.\"\"\"\n+    print(\"=== Testing Basic Request Preparation ===\")\n+    \n+    # Test GET request\n+    req = Request('GET', 'http://example.com')\n+    prepared = req.prepare()\n+    print(f\"GET request prepared successfully: {prepared}\")\n+    print(f\"GET headers: {dict(prepared.headers)}\")\n+    \n+    # Test POST request\n+    req = Request('POST', 'http://example.com', data={'key': 'value'})\n+    prepared = req.prepare()\n+    print(f\"POST request prepared successfully: {prepared}\")\n+    print(f\"POST headers: {dict(prepared.headers)}\")\n+    \n+    # Test PUT request\n+    req = Request('PUT', 'http://example.com', data={'key': 'value'})\n+    prepared = req.prepare()\n+    print(f\"PUT request prepared successfully: {prepared}\")\n+    print(f\"PUT headers: {dict(prepared.headers)}\")\n+    \n+    print(\"\u2713 All basic request preparations work correctly\")\n+\n+def test_content_length_behavior():\n+    \"\"\"Test the specific Content-Length behavior.\"\"\"\n+    print(\"\\n=== Testing Content-Length Behavior ===\")\n+    \n+    # Methods that should NOT have Content-Length with empty body\n+    no_content_length_methods = ['GET', 'HEAD', 'DELETE', 'OPTIONS']\n+    for method in no_content_length_methods:\n+        req = Request(method, 'http://example.com')\n+        prepared = req.prepare()\n+        if 'Content-Length' in prepared.headers:\n+            print(f\"\u2717 {method}: Unexpected Content-Length: {prepared.headers['Content-Length']}\")\n+            return False\n+        else:\n+            print(f\"\u2713 {method}: No Content-Length (correct)\")\n+    \n+    # Methods that SHOULD have Content-Length with empty body\n+    content_length_methods = ['POST', 'PUT', 'PATCH']\n+    for method in content_length_methods:\n+        req = Request(method, 'http://example.com')\n+        prepared = req.prepare()\n+        if 'Content-Length' in prepared.headers:\n+            print(f\"\u2713 {method}: Content-Length = {prepared.headers['Content-Length']} (correct)\")\n+        else:\n+            print(f\"\u2717 {method}: Missing Content-Length\")\n+            return False\n+    \n+    # All methods should have Content-Length when there's actual data\n+    all_methods = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS']\n+    for method in all_methods:\n+        req = Request(method, 'http://example.com', data={'key': 'value'})\n+        prepared = req.prepare()\n+        if 'Content-Length' in prepared.headers:\n+            print(f\"\u2713 {method} with data: Content-Length = {prepared.headers['Content-Length']} (correct)\")\n+        else:\n+            print(f\"\u2717 {method} with data: Missing Content-Length\")\n+            return False\n+    \n+    return True\n+\n+if __name__ == \"__main__\":\n+    try:\n+        test_basic_request_preparation()\n+        success = test_content_length_behavior()\n+        \n+        if success:\n+            print(\"\\n=== ALL TESTS PASSED ===\")\n+            print(\"Content-Length behavior is working correctly\")\n+        else:\n+            print(\"\\n=== SOME TESTS FAILED ===\")\n+            print(\"There are issues with Content-Length behavior\")\n+    except Exception as e:\n+        print(f\"\\n=== ERROR ===\")\n+        print(f\"Exception occurred: {e}\")\n+        import traceback\n+        traceback.print_exc()\n\\ No newline at end of file\ndiff --git a/test_comprehensive.py b/test_comprehensive.py\nnew file mode 100644\nindex 0000000..11eece3\n--- /dev/null\n+++ b/test_comprehensive.py\n@@ -0,0 +1,129 @@\n+#!/usr/bin/env python\n+\"\"\"Comprehensive test of the Content-Length fix.\"\"\"\n+\n+import requests\n+from requests.models import Request\n+from io import StringIO, BytesIO\n+\n+def test_all_scenarios():\n+    \"\"\"Test all possible scenarios for Content-Length behavior.\"\"\"\n+    print(\"=== Comprehensive Content-Length Test ===\")\n+    \n+    test_cases = [\n+        # Format: (method, data, files, expected_has_content_length, description)\n+        \n+        # GET requests - should NOT have Content-Length when no body\n+        ('GET', None, None, False, 'GET with no data'),\n+        ('GET', {}, None, False, 'GET with empty dict'),\n+        ('GET', [], None, False, 'GET with empty list'),\n+        ('GET', '', None, False, 'GET with empty string'),\n+        \n+        # GET requests - SHOULD have Content-Length when there's body data\n+        ('GET', {'key': 'value'}, None, True, 'GET with data dict'),\n+        ('GET', 'string data', None, True, 'GET with string data'),\n+        ('GET', b'bytes data', None, True, 'GET with bytes data'),\n+        \n+        # HEAD requests - should NOT have Content-Length when no body\n+        ('HEAD', None, None, False, 'HEAD with no data'),\n+        ('HEAD', {}, None, False, 'HEAD with empty dict'),\n+        \n+        # HEAD requests - SHOULD have Content-Length when there's body data\n+        ('HEAD', {'key': 'value'}, None, True, 'HEAD with data dict'),\n+        \n+        # DELETE requests - should NOT have Content-Length when no body\n+        ('DELETE', None, None, False, 'DELETE with no data'),\n+        ('DELETE', {}, None, False, 'DELETE with empty dict'),\n+        \n+        # DELETE requests - SHOULD have Content-Length when there's body data\n+        ('DELETE', {'key': 'value'}, None, True, 'DELETE with data dict'),\n+        \n+        # OPTIONS requests - should NOT have Content-Length when no body\n+        ('OPTIONS', None, None, False, 'OPTIONS with no data'),\n+        ('OPTIONS', {}, None, False, 'OPTIONS with empty dict'),\n+        \n+        # OPTIONS requests - SHOULD have Content-Length when there's body data\n+        ('OPTIONS', {'key': 'value'}, None, True, 'OPTIONS with data dict'),\n+        \n+        # POST requests - SHOULD have Content-Length even when no body\n+        ('POST', None, None, True, 'POST with no data'),\n+        ('POST', {}, None, True, 'POST with empty dict'),\n+        ('POST', {'key': 'value'}, None, True, 'POST with data dict'),\n+        \n+        # PUT requests - SHOULD have Content-Length even when no body\n+        ('PUT', None, None, True, 'PUT with no data'),\n+        ('PUT', {}, None, True, 'PUT with empty dict'),\n+        ('PUT', {'key': 'value'}, None, True, 'PUT with data dict'),\n+        \n+        # PATCH requests - SHOULD have Content-Length even when no body\n+        ('PATCH', None, None, True, 'PATCH with no data'),\n+        ('PATCH', {}, None, True, 'PATCH with empty dict'),\n+        ('PATCH', {'key': 'value'}, None, True, 'PATCH with data dict'),\n+    ]\n+    \n+    all_passed = True\n+    \n+    for method, data, files, expected_has_content_length, description in test_cases:\n+        req = Request(method, 'http://example.com', data=data, files=files)\n+        prepared = req.prepare()\n+        \n+        has_content_length = 'Content-Length' in prepared.headers\n+        \n+        if has_content_length == expected_has_content_length:\n+            status = \"\u2713 PASS\"\n+        else:\n+            status = \"\u2717 FAIL\"\n+            all_passed = False\n+        \n+        content_length_info = \"\"\n+        if has_content_length:\n+            content_length_info = f\" (Content-Length: {prepared.headers['Content-Length']})\"\n+        \n+        print(f\"{status}: {description}{content_length_info}\")\n+    \n+    return all_passed\n+\n+def test_file_scenarios():\n+    \"\"\"Test file upload scenarios.\"\"\"\n+    print(\"\\n=== File Upload Scenarios ===\")\n+    \n+    test_cases = [\n+        # All methods with files should have Content-Length\n+        ('GET', None, {'file': ('test.txt', 'test content')}, True, 'GET with text file'),\n+        ('POST', None, {'file': ('test.txt', 'test content')}, True, 'POST with text file'),\n+        ('PUT', None, {'file': ('test.bin', b'test bytes content')}, True, 'PUT with bytes file'),\n+        ('PATCH', None, {'file': ('test.txt', 'test content')}, True, 'PATCH with file'),\n+    ]\n+    \n+    all_passed = True\n+    \n+    for method, data, files, expected_has_content_length, description in test_cases:\n+        req = Request(method, 'http://example.com', data=data, files=files)\n+        prepared = req.prepare()\n+        \n+        has_content_length = 'Content-Length' in prepared.headers\n+        \n+        if has_content_length == expected_has_content_length:\n+            status = \"\u2713 PASS\"\n+        else:\n+            status = \"\u2717 FAIL\"\n+            all_passed = False\n+        \n+        content_length_info = \"\"\n+        if has_content_length:\n+            content_length_info = f\" (Content-Length: {prepared.headers['Content-Length']})\"\n+        \n+        print(f\"{status}: {description}{content_length_info}\")\n+    \n+    return all_passed\n+\n+if __name__ == \"__main__\":\n+    success1 = test_all_scenarios()\n+    success2 = test_file_scenarios()\n+    \n+    print(\"\\n\" + \"=\" * 50)\n+    if success1 and success2:\n+        print(\"\ud83c\udf89 ALL COMPREHENSIVE TESTS PASSED!\")\n+        print(\"\u2713 Content-Length behavior is correct for all scenarios\")\n+    else:\n+        print(\"\u274c SOME COMPREHENSIVE TESTS FAILED!\")\n+        print(\"\u2717 There are still issues with Content-Length behavior\")\n\\ No newline at end of file\ndiff --git a/test_edge_cases.py b/test_edge_cases.py\nnew file mode 100644\nindex 0000000..76fa420\n--- /dev/null\n+++ b/test_edge_cases.py\n@@ -0,0 +1,72 @@\n+#!/usr/bin/env python\n+\"\"\"Test edge cases for the Content-Length fix.\"\"\"\n+\n+import requests\n+from requests.models import PreparedRequest\n+\n+def test_various_methods():\n+    \"\"\"Test different HTTP methods.\"\"\"\n+    methods_should_have_content_length = ['POST', 'PUT', 'PATCH']\n+    methods_should_not_have_content_length = ['GET', 'HEAD', 'DELETE', 'OPTIONS']\n+    \n+    print(\"=== Testing methods that should have Content-Length with empty body ===\")\n+    for method in methods_should_have_content_length:\n+        req = requests.Request(method, 'http://httpbin.org/test')\n+        prepared = req.prepare()\n+        \n+        if 'Content-Length' in prepared.headers:\n+            print(f\"\u2713 {method}: Content-Length = {prepared.headers['Content-Length']}\")\n+        else:\n+            print(f\"\u2717 {method}: No Content-Length header (PROBLEM)\")\n+    \n+    print(\"\\n=== Testing methods that should NOT have Content-Length with empty body ===\")\n+    for method in methods_should_not_have_content_length:\n+        req = requests.Request(method, 'http://httpbin.org/test')\n+        prepared = req.prepare()\n+        \n+        if 'Content-Length' in prepared.headers:\n+            print(f\"\u2717 {method}: Content-Length = {prepared.headers['Content-Length']} (PROBLEM)\")\n+        else:\n+            print(f\"\u2713 {method}: No Content-Length header\")\n+\n+def test_with_actual_data():\n+    \"\"\"Test that methods with actual data still get Content-Length.\"\"\"\n+    print(\"\\n=== Testing methods with actual data ===\")\n+    \n+    test_data = {'key': 'value'}\n+    methods = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE']\n+    \n+    for method in methods:\n+        req = requests.Request(method, 'http://httpbin.org/test', data=test_data)\n+        prepared = req.prepare()\n+        \n+        if 'Content-Length' in prepared.headers:\n+            print(f\"\u2713 {method} with data: Content-Length = {prepared.headers['Content-Length']}\")\n+        else:\n+            print(f\"\u2717 {method} with data: No Content-Length header (PROBLEM)\")\n+\n+def test_empty_data_variations():\n+    \"\"\"Test various ways of specifying empty data.\"\"\"\n+    print(\"\\n=== Testing empty data variations for GET ===\")\n+    \n+    variations = [\n+        (\"no data param\", {}),\n+        (\"data=None\", {'data': None}),\n+        (\"data={}\", {'data': {}}),\n+        (\"data=[]\", {'data': []}),\n+        (\"data=''\", {'data': ''}),\n+    ]\n+    \n+    for desc, kwargs in variations:\n+        req = requests.Request('GET', 'http://httpbin.org/test', **kwargs)\n+        prepared = req.prepare()\n+        \n+        if 'Content-Length' in prepared.headers:\n+            print(f\"\u2717 GET {desc}: Content-Length = {prepared.headers['Content-Length']} (PROBLEM)\")\n+        else:\n+            print(f\"\u2713 GET {desc}: No Content-Length header\")\n+\n+if __name__ == \"__main__\":\n+    test_various_methods()\n+    test_with_actual_data()\n+    test_empty_data_variations()\n\\ No newline at end of file\ndiff --git a/test_file_uploads.py b/test_file_uploads.py\nnew file mode 100644\nindex 0000000..5c71d83\n--- /dev/null\n+++ b/test_file_uploads.py\n@@ -0,0 +1,87 @@\n+#!/usr/bin/env python\n+\"\"\"Test file uploads to ensure Content-Length is handled correctly.\"\"\"\n+\n+import requests\n+from requests.models import Request\n+from io import StringIO\n+\n+def test_file_uploads():\n+    \"\"\"Test that file uploads still work correctly.\"\"\"\n+    print(\"=== Testing File Uploads ===\")\n+    \n+    # Create a simple file-like object\n+    file_content = \"This is test file content\"\n+    file_obj = StringIO(file_content)\n+    \n+    # Test POST with files\n+    req = Request('POST', 'http://example.com', files={'file': file_obj})\n+    prepared = req.prepare()\n+    \n+    print(f\"POST with files headers: {dict(prepared.headers)}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\u2713 POST with files: Content-Length = {prepared.headers['Content-Length']}\")\n+    else:\n+        print(\"\u2717 POST with files: Missing Content-Length\")\n+        return False\n+    \n+    # Test GET with files (unusual but should still work)\n+    file_obj.seek(0)  # Reset file position\n+    req = Request('GET', 'http://example.com', files={'file': file_obj})\n+    prepared = req.prepare()\n+    \n+    print(f\"GET with files headers: {dict(prepared.headers)}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\u2713 GET with files: Content-Length = {prepared.headers['Content-Length']}\")\n+    else:\n+        print(\"\u2717 GET with files: Missing Content-Length\")\n+        return False\n+    \n+    return True\n+\n+def test_streaming_data():\n+    \"\"\"Test streaming data.\"\"\"\n+    print(\"\\n=== Testing Streaming Data ===\")\n+    \n+    # Test with a generator (streaming data)\n+    def data_generator():\n+        yield b\"chunk1\"\n+        yield b\"chunk2\"\n+        yield b\"chunk3\"\n+    \n+    # Test POST with streaming data\n+    req = Request('POST', 'http://example.com', data=data_generator())\n+    prepared = req.prepare()\n+    \n+    print(f\"POST with streaming data headers: {dict(prepared.headers)}\")\n+    \n+    # Streaming data should either have Content-Length or Transfer-Encoding\n+    has_content_length = 'Content-Length' in prepared.headers\n+    has_transfer_encoding = 'Transfer-Encoding' in prepared.headers\n+    \n+    if has_content_length or has_transfer_encoding:\n+        if has_content_length:\n+            print(f\"\u2713 POST with streaming: Content-Length = {prepared.headers['Content-Length']}\")\n+        if has_transfer_encoding:\n+            print(f\"\u2713 POST with streaming: Transfer-Encoding = {prepared.headers['Transfer-Encoding']}\")\n+    else:\n+        print(\"\u2717 POST with streaming: Missing both Content-Length and Transfer-Encoding\")\n+        return False\n+    \n+    return True\n+\n+if __name__ == \"__main__\":\n+    try:\n+        success1 = test_file_uploads()\n+        success2 = test_streaming_data()\n+        \n+        if success1 and success2:\n+            print(\"\\n=== ALL FILE UPLOAD TESTS PASSED ===\")\n+        else:\n+            print(\"\\n=== SOME FILE UPLOAD TESTS FAILED ===\")\n+    except Exception as e:\n+        print(f\"\\n=== ERROR ===\")\n+        print(f\"Exception occurred: {e}\")\n+        import traceback\n+        traceback.print_exc()\n\\ No newline at end of file\ndiff --git a/test_original_issue.py b/test_original_issue.py\nnew file mode 100644\nindex 0000000..ccaf959\n--- /dev/null\n+++ b/test_original_issue.py\n@@ -0,0 +1,117 @@\n+#!/usr/bin/env python\n+\"\"\"Test that the original issue described in the PR is fixed.\"\"\"\n+\n+import requests\n+\n+def test_original_issue():\n+    \"\"\"\n+    Test the original issue: requests.get should not always send content-length header.\n+    \n+    The PR description states:\n+    \"It seems like that request.get always adds 'content-length' header to the request.\n+    I think that the right behavior is not to add this header automatically in GET requests\n+    or add the possibility to not send it.\"\n+    \"\"\"\n+    print(\"=== Testing Original Issue ===\")\n+    print(\"Issue: requests.get is ALWAYS sending content length\")\n+    print()\n+    \n+    # Test 1: Basic GET request should not have Content-Length\n+    print(\"Test 1: Basic GET request\")\n+    req = requests.Request('GET', 'http://amazon.com')\n+    prepared = req.prepare()\n+    \n+    print(f\"Headers: {dict(prepared.headers)}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\u2717 FAIL: Content-Length header is present: {prepared.headers['Content-Length']}\")\n+        print(\"  This would cause amazon.com to return 503\")\n+        return False\n+    else:\n+        print(\"\u2713 PASS: No Content-Length header found\")\n+        print(\"  This should work fine with amazon.com\")\n+    \n+    print()\n+    \n+    # Test 2: GET request with explicit data=None should not have Content-Length\n+    print(\"Test 2: GET request with data=None\")\n+    req = requests.Request('GET', 'http://amazon.com', data=None)\n+    prepared = req.prepare()\n+    \n+    print(f\"Headers: {dict(prepared.headers)}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\u2717 FAIL: Content-Length header is present: {prepared.headers['Content-Length']}\")\n+        return False\n+    else:\n+        print(\"\u2713 PASS: No Content-Length header found\")\n+    \n+    print()\n+    \n+    # Test 3: GET request with empty dict should not have Content-Length\n+    print(\"Test 3: GET request with data={}\")\n+    req = requests.Request('GET', 'http://amazon.com', data={})\n+    prepared = req.prepare()\n+    \n+    print(f\"Headers: {dict(prepared.headers)}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\u2717 FAIL: Content-Length header is present: {prepared.headers['Content-Length']}\")\n+        return False\n+    else:\n+        print(\"\u2713 PASS: No Content-Length header found\")\n+    \n+    print()\n+    \n+    # Test 4: Verify that POST requests still work correctly\n+    print(\"Test 4: POST request should still have Content-Length\")\n+    req = requests.Request('POST', 'http://httpbin.org/post', data={'key': 'value'})\n+    prepared = req.prepare()\n+    \n+    print(f\"Headers: {dict(prepared.headers)}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\u2713 PASS: Content-Length header is present: {prepared.headers['Content-Length']}\")\n+    else:\n+        print(\"\u2717 FAIL: Content-Length header is missing for POST\")\n+        return False\n+    \n+    return True\n+\n+def test_using_requests_api():\n+    \"\"\"Test using the actual requests.get API function.\"\"\"\n+    print(\"\\n=== Testing with requests.get() API ===\")\n+    \n+    # We can't actually make the request, but we can prepare it through the session\n+    session = requests.Session()\n+    \n+    # Prepare a GET request\n+    req = requests.Request('GET', 'http://amazon.com')\n+    prepared = req.prepare()\n+    \n+    print(f\"requests.get() equivalent headers: {dict(prepared.headers)}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\u2717 FAIL: requests.get() would send Content-Length: {prepared.headers['Content-Length']}\")\n+        return False\n+    else:\n+        print(\"\u2713 PASS: requests.get() would not send Content-Length header\")\n+        return True\n+\n+if __name__ == \"__main__\":\n+    print(\"Testing fix for: requests.get is ALWAYS sending content length\")\n+    print(\"=\" * 60)\n+    \n+    success1 = test_original_issue()\n+    success2 = test_using_requests_api()\n+    \n+    print(\"\\n\" + \"=\" * 60)\n+    if success1 and success2:\n+        print(\"\ud83c\udf89 SUCCESS: Original issue has been FIXED!\")\n+        print(\"\u2713 GET requests no longer automatically include Content-Length header\")\n+        print(\"\u2713 This should resolve the amazon.com 503 error issue\")\n+        print(\"\u2713 POST requests still work correctly\")\n+    else:\n+        print(\"\u274c FAILURE: Original issue is NOT fixed\")\n+        print(\"\u2717 GET requests still include Content-Length header\")\n+        print(\"\u2717 This would still cause issues with servers like amazon.com\")\n\\ No newline at end of file\ndiff --git a/test_requests_get.py b/test_requests_get.py\nnew file mode 100644\nindex 0000000..a157cc0\n--- /dev/null\n+++ b/test_requests_get.py\n@@ -0,0 +1,52 @@\n+#!/usr/bin/env python\n+\"\"\"Test the actual requests.get function.\"\"\"\n+\n+import requests\n+\n+def test_requests_get():\n+    \"\"\"Test that requests.get doesn't send Content-Length.\"\"\"\n+    print(\"=== Testing requests.get() ===\")\n+    \n+    # We can't actually make the request, but we can prepare it\n+    req = requests.Request('GET', 'http://httpbin.org/get')\n+    prepared = req.prepare()\n+    \n+    print(\"Headers for requests.get():\")\n+    for header, value in prepared.headers.items():\n+        print(f\"  {header}: {value}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\\n\u2717 PROBLEM: Content-Length header is present: {prepared.headers['Content-Length']}\")\n+        return False\n+    else:\n+        print(\"\\n\u2713 OK: No Content-Length header found\")\n+        return True\n+\n+def test_requests_post():\n+    \"\"\"Test that requests.post still sends Content-Length.\"\"\"\n+    print(\"\\n=== Testing requests.post() ===\")\n+    \n+    req = requests.Request('POST', 'http://httpbin.org/post', data={'key': 'value'})\n+    prepared = req.prepare()\n+    \n+    print(\"Headers for requests.post():\")\n+    for header, value in prepared.headers.items():\n+        print(f\"  {header}: {value}\")\n+    \n+    if 'Content-Length' in prepared.headers:\n+        print(f\"\\n\u2713 OK: Content-Length header is present: {prepared.headers['Content-Length']}\")\n+        return True\n+    else:\n+        print(\"\\n\u2717 PROBLEM: No Content-Length header found\")\n+        return False\n+\n+if __name__ == \"__main__\":\n+    get_ok = test_requests_get()\n+    post_ok = test_requests_post()\n+    \n+    if get_ok and post_ok:\n+        print(\"\\n=== ALL TESTS PASSED ===\")\n+        print(\"requests.get() and requests.post() behave correctly\")\n+    else:\n+        print(\"\\n=== SOME TESTS FAILED ===\")\n+        print(\"There are still issues with the implementation\")\n\\ No newline at end of file\n"}